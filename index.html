<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-US">
<head>
<title>Deploying multiple OpenStack clouds with Ansible</title>
<meta name="generator" content=
"HTML Tidy for Linux/x86 (vers 1st November 2003), see www.w3.org" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="copyright" content=
"Copyright &#169; 2005-2010 W3C (MIT, ERCIM, Keio)" />
<meta name="duration" content="60" />
<meta name="font-size-adjustment" content="0" />
<link rel="stylesheet" href="styles/slidy.css" type="text/css" />
<link rel="stylesheet" href="styles/openstack.css" type="text/css" />
<script src="scripts/slidy.js" charset="utf-8" type="text/javascript"></script>
</head>
<body>
<div class="background"><img alt="" id="head-icon"
src="graphics/openstack-cloud-software-horizontal-small.png" /></div>

<div class="slide cover titlepage">
  <!-- hidden style graphics to ensure they are saved with other content -->
  <img class="hidden" src="graphics/bullet.png" alt="" />
  <img class="hidden" src="graphics/fold.gif" alt="" />
  <img class="hidden" src="graphics/unfold.gif" alt="" />
  <img class="hidden" src="graphics/fold-dim.gif" alt="" />
  <img class="hidden" src="graphics/nofold-dim.gif" alt="" />
  <img class="hidden" src="graphics/unfold-dim.gif" alt="" />
  <img class="hidden" src="graphics/bullet-fold.gif" alt="" />
  <img class="hidden" src="graphics/bullet-unfold.gif" alt="" />
  <img class="hidden" src="graphics/bullet-fold-dim.gif" alt="" />
  <img class="hidden" src="graphics/bullet-nofold-dim.gif" alt="" />
  <img class="hidden" src="graphics/bullet-unfold-dim.gif" alt="" />
  <img src="graphics/openstack-cloud-software-vertical-large.png" alt="OpenStack logo" class="cover" />
  <h1>Deploying multiple OpenStack clouds with Ansible<br />
  <span class="smaller">(in a data-driven fashion)</span></h1>
  <hr />
  <div class="smaller">Ricardo Carrillo Cruz
    &lt;<a href="mailto:ricardo.carrillo.cruz@gmail.com">ricardo.carrillo.cruz@gmail.com</a>&gt;</div>
</div>

<div class="slide">
  <h1>Who am I?</h1>

  <p>
    <ul>
      <li>OpenStack Software Engineer at HPE</li>
      <li>Work in team focused on doing OpenStack upstream</li>
      <li>Specialized in OpenStack Infra</li>
      <li>Lots of interest in Ansible and automation in general</li>
    </ul>
  </p>

</div>

<div class="slide">
  <h1>What's Ansible?</h1>

  <p>
    <ul>
      <li>Ansible is an automation tool</li>
      <li>Can be used for configuration management, application deployment, cloud provisioning <b>and</b> orquestration</li>
      <li>Uses YAML as idiom to express things</li>
      <li>Free and open-source</li>
      <li>Easy to learn and comes with <b>lots</b> of out-of-the-box modules to automate all the various IT tasks</li>
      <li></li>
    </ul>
  </p>

</div>

<div class="slide">
  <h1>Ansible OpenStack modules</h1>

  <p>
    <ul>
      <li>Ansible has a wide variety of OpenStack modules</li>
      <li>These modules allow you to deploy the expected resources you use in OpenStack (servers, volumes, networks, projects, etc)</li>
      <li>They leverage OSCC tool to define clouds details (auth urls, credentials, versions, etc)</li>

    </ul>
  </p>

</div>

<div class="slide">
  <h1>Example on how to create an OpenStack server with Ansible</h1>
      <pre>
---
- hosts: localhost
  connection: local
  gather_facts: false
  tasks:
  - os_server:
      cloud: yaycloud
      name: nagios
      image: ubuntu-trusty 
      key_name: bootstrap-key 
      flavor: m1.small 
      network: test-net
      </pre>
</div>

<div class="slide">
  <h1>Problems of playbook with plain OpenStack modules approach</h1>

  <p>
    <ul>
      <li>Playbooks become unwieldy on mid-large setups with lots of resources</li>
      <li>If we manage multiple clouds with similar resources we end up with multiple playbooks repeating the same Ansible code</li>
      <li>Need to keep an order on the resources creation</li>
    </ul>
  </p>
</div>

<div class="slide">
  <h1>Requirements to better provision multiple clouds</h1>
    <ul>
      <li>Decouple configuration from code (our clouds layouts from Ansible code)</li>
      <li>Be able to define clouds resources in a declarative way</li>
      <li>Be able to define as many resources as we want, on as many clouds as we like</li>
      <li>Be able to re-use common resources on multiple clouds without repeating ourselves
      </li>
    </ul>
</div>

<div class="slide">
  <h1>ansible-openstack-cloud-launcher (AOCL) role</h1>
    <ul>
      <li>Consumes a resources YAML file that declares OpenStack resources</li>
      <li>Role expects the resources YAML file follows a super-minimal 'DSL'<li>
      <li>Order of resources is not important</li>
      <li>Accepts 'profiles' of resources to re-use common resources in multiple clouds</li>
      <li>Accepts per-cloud specific resources</li>
    </ul>
</div>

<div class="slide">
  <h1>Example of resources.yml</h1>
  <pre>
profiles:
  - name: bootstrap-keypair
    keypairs:
      - name: bootstrap-key
        public_key_file: /home/vagrant/.ssh/id_rsa.pub
  - name: monitoring
    servers:
      - name: nagios
        image: ubuntu-trusty
        key_name: bootstrap-key
        flavor: m1.small
clouds:
  - name: awesomecloud
    profiles:
      - bootstrap-keypair
      - monitoring
  - name: yaycloud
    servers:
      - name: logserver
        image: centos7
        flavor: m1.large
  </pre>
</div>

<div class="slide">
  <h1>Example of AOCL role play</h1>
  <p>
  <ul>
  <li>Create your own <em>resources.yml</em> as shown on previous slide</li>
  <li>Create a playbook named <em>test_aocl.yml</em> with contents:</li>
  <pre>
---
- hosts: localhost
  connection: local
  gather_facts: false
  roles:
    - { role: ansible-openstack-cloud-launcher }
  </pre>
  <li>Run <em>ansible-playbook -i ‘localhost,’ test_aocl.yml -e “@resources.yml”</em></li>
  </p>
</div>

<div class="slide">
  <h1>Thank you!</h1>
  <p>
    The ansible-openstack-cloud-launcher role is available at: <a href="https://github.com/rcarrillocruz/ansible-openstack-cloud-launcher/">https://github.com/rcarrillocruz/ansible-openstack-cloud-launcher/</a>
  </p>
  <p>
    A blogpost showing the role in detail can be seen at: <a href="http://rcarrillocruz.com/deploying-multiple-openstack-clouds-with-ansible-in-a-data-driven-fashion/">http://rcarrillocruz.com/deploying-multiple-openstack-clouds-with-ansible-in-a-data-driven-fashion/</a>
  </p>

  <p>IRC: rcarrillocruz
  </p>
  
  <p>Twitter: @rcarrillocruz
  </p>

</div>

</body>
</html>
